#!/bin/bash
# EDDI Tor Client - Connect to any URL via Tor
# Supports both Tor hidden services (.onion) and regular websites (via Tor exit)
# Usage: ./eddi-connect <url>

set -e

echo "ğŸŒ EDDI Tor Client"
echo ""

# Build if needed
if [ ! -f "target/release/tor-http-client" ]; then
    echo "ğŸ“¦ Building client (first time only)..."
    cargo build --release --bin tor-http-client --quiet
    echo "âœ… Build complete"
    echo ""
fi

# Get URL from command line or saved address
if [ $# -eq 1 ]; then
    URL="$1"
elif [ -f ".onion_address" ]; then
    URL=$(cat .onion_address)
    echo "ğŸ“ Using saved address: $URL"
    echo ""
else
    echo "âŒ No URL provided"
    echo ""
    echo "Usage:"
    echo "  ./eddi-connect <url>"
    echo ""
    echo "Examples:"
    echo "  Tor Hidden Services (.onion):"
    echo "    ./eddi-connect http://example.onion"
    echo "    ./eddi-connect example.onion/status"
    echo "    ./eddi-connect http://example.onion:8080/api"
    echo ""
    echo "  Regular Websites (via Tor anonymously):"
    echo "    ./eddi-connect https://check.torproject.org"
    echo "    ./eddi-connect http://httpbin.org/ip"
    echo "    ./eddi-connect https://www.eff.org"
    echo ""
    echo "Or start the EDDI server first with: ./eddi-server"
    exit 1
fi

echo "ğŸ”— Connecting to: $URL"
echo "â³ First connection may take 10-30 seconds..."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Connect via Tor
# The tor-http-client handles all URL formats automatically:
# - .onion addresses: direct connection within Tor network
# - Regular URLs: anonymized connection via Tor exit nodes
exec target/release/tor-http-client "$URL"
